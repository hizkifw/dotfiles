export ZSH="$HOME/.oh-my-zsh"
ZSH_THEME="robbyrussell"

# Fuzzy completion
CASE_SENSITIVE=false
HYPHEN_INSENSITIVE=true

# Automatically update without prompting
DISABLE_UPDATE_PROMPT=true
plugins=(git)

source $ZSH/oh-my-zsh.sh

# Add ~/.local/bin to path
typeset -U path # make path unique
path[1,0]=~/.local/bin

# Add ~/.local/app/*/bin to path
for app in ~/.local/app/*; do
    if [ -d "$app/bin" ]; then
        path+=("$app/bin")
    fi
done

path+=("$HOME/.cargo/bin")
path+=("$HOME/go/bin")

# Aliases
alias t="tmux"
alias k="kubectl"
alias gpoh="git push -u origin HEAD"
alias clip="xclip -selection clipboard"
alias hl="highlight -O ansi -l"

# fix kitty ssh
alias ssh="TERM=xterm-256color ssh"

# vim
alias v="nvim"
alias vi="nvim"
alias vim="nvim"

# global config
export EDITOR="nvim"
export BROWSER="chromium"
export TERMINAL="kitty"

# ssh gpg agent
export SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)
gpgconf --launch gpg-agent
gpg-connect-agent updatestartuptty /bye >/dev/null

# direnv hook
command -v direnv &>/dev/null && eval "$(direnv hook zsh)"

# pyenv
command -v pyenv &>/dev/null && \
  eval "$(pyenv init --path)" && \
  eval "$(pyenv init -)" && \
  pyenv virtualenv --help &>/dev/null &&\
    eval "$(pyenv virtualenv-init -)"

# Enable nvm on-demand
nvm() {
  export NVM_DIR="$HOME/.nvm"
  [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
  [ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion
}

# gcloud autocompletion
[[ -f /opt/google-cloud-sdk/completion.zsh.inc ]] && source /opt/google-cloud-sdk/completion.zsh.inc

# shrink pdf
shrinkpdf() {
  infile="$1"
  outfile="$2"
  if [ -z "$outfile" ]; then
    echo "Usage: shrinkpdf <infile> <outfile>"
    return 1
  fi
  gs -dNOPAUSE -dBATCH -sDEVICE=pdfwrite -dCompatibilityLevel=1.4 -dPDFSETTINGS=/printer -sOutputFile="$outfile" "$infile"
}
